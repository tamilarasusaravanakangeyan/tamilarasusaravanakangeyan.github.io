{{/* Breadcrumb Navigation Component */}}
{{- $currentPage := . -}}
{{- $sections := split .RelPermalink "/" -}}
{{- $sections = where $sections "!=" "" -}}

<nav class="breadcrumbs" aria-label="Breadcrumb navigation">
  <ol class="breadcrumb-list" itemscope itemtype="https://schema.org/BreadcrumbList">
    
    {{/* Home breadcrumb */}}
    <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a href="/" class="breadcrumb-link" itemprop="item">
        <span itemprop="name">
          <svg class="breadcrumb-home-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
            <polyline points="9,22 9,12 15,12 15,22"/>
          </svg>
          Home
        </span>
      </a>
      <meta itemprop="position" content="1">
      <span class="breadcrumb-separator" aria-hidden="true">/</span>
    </li>

    {{/* Generate breadcrumbs for each section */}}
    {{- $position := 2 -}}
    {{- $currentPath := "" -}}
    
    {{- range $index, $section := $sections -}}
      {{- $currentPath = printf "%s/%s" $currentPath $section -}}
      {{- $isLast := eq $index (sub (len $sections) 1) -}}
      
      {{/* Try to find the section page */}}
      {{- $sectionPage := site.GetPage $currentPath -}}
      {{- if not $sectionPage -}}
        {{- $sectionPage = site.GetPage (printf "%s/_index" $currentPath) -}}
      {{- end -}}
      
      <li class="breadcrumb-item{{ if $isLast }} current{{ end }}" 
          itemprop="itemListElement" 
          itemscope 
          itemtype="https://schema.org/ListItem">
        
        {{- if and (not $isLast) $sectionPage -}}
          <a href="{{ $sectionPage.RelPermalink }}" class="breadcrumb-link" itemprop="item">
            <span itemprop="name">{{ $sectionPage.Title | default (title $section) }}</span>
          </a>
        {{- else if not $isLast -}}
          <a href="{{ $currentPath }}/" class="breadcrumb-link" itemprop="item">
            <span itemprop="name">{{ title $section }}</span>
          </a>
        {{- else -}}
          <span class="breadcrumb-current" itemprop="item">
            <span itemprop="name">{{ $currentPage.Title | default (title $section) }}</span>
          </span>
        {{- end -}}
        
        <meta itemprop="position" content="{{ $position }}">
        
        {{- if not $isLast -}}
          <span class="breadcrumb-separator" aria-hidden="true">/</span>
        {{- end -}}
      </li>
      
      {{- $position = add $position 1 -}}
    {{- end -}}
    
  </ol>
</nav>

{{/* Structured Data for Breadcrumbs */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ .Site.BaseURL }}"
    }
    {{- $position := 2 -}}
    {{- $currentPath := "" -}}
    {{- range $index, $section := $sections -}}
      {{- $currentPath = printf "%s/%s" $currentPath $section -}}
      {{- $sectionPage := site.GetPage $currentPath -}}
      {{- if not $sectionPage -}}
        {{- $sectionPage = site.GetPage (printf "%s/_index" $currentPath) -}}
      {{- end -}}
    ,{
      "@type": "ListItem",
      "position": {{ $position }},
      "name": "{{ if $sectionPage }}{{ $sectionPage.Title }}{{ else }}{{ title $section }}{{ end }}",
      "item": "{{ .Site.BaseURL }}{{ $currentPath }}/"
    }
      {{- $position = add $position 1 -}}
    {{- end -}}
  ]
}
</script>